#ifndef ROOM_DATA_H
#define ROOM_DATA_H

#define ROOM_WIDTH 774
#define ROOM_HEIGHT 774

#define ROOM_LEVEL_COUNT 3

static const ObjectInstance room_instances[ENT_DONE] = {
  {ENT_PERSON,SIZE_MEDIUM,"Frank the Tank",1,1,1,SPAWN_SOLO,{GEAR_MACE, GEAR_LEATHER_ARMOR},{}},
  {ENT_GOBLIN,SIZE_SMALL,"Goblin",2,4,1,SPAWN_PACK,
    {GEAR_NONE},
    {ABILITY_DONE},
    {
      [STATE_IDLE]= BEHAVIOR_SEEK,
      [STATE_WANDER]= BEHAVIOR_WANDER,
      [STATE_AGGRO]= BEHAVIOR_MOB_AGGRO,
      [STATE_ACTION] = BEHAVIOR_TAKE_ACTION,
      [STATE_ATTACK] = BEHAVIOR_COMBAT,
    }},
  {ENT_ORC,SIZE_MEDIUM,"Orc", 1,3,3,SPAWN_SOLO,{GEAR_NONE},
    {ABILITY_DONE},
    {
      [STATE_IDLE]= BEHAVIOR_SEEK,
      [STATE_WANDER]= BEHAVIOR_WANDER,
      [STATE_AGGRO]= BEHAVIOR_MOB_AGGRO,
      [STATE_ACTION] = BEHAVIOR_TAKE_ACTION,
      [STATE_ATTACK] = BEHAVIOR_COMBAT,
    }},
  {ENT_OGRE,SIZE_LARGE,"Ogre", 1,1,5,SPAWN_SOLO,
    {GEAR_NONE},
    {ABILITY_DONE},
    {
      [STATE_IDLE]= BEHAVIOR_SEEK,
      [STATE_WANDER]= BEHAVIOR_WANDER,
      [STATE_AGGRO]= BEHAVIOR_MOB_AGGRO,
      [STATE_ACTION] = BEHAVIOR_TAKE_ACTION,
      [STATE_ATTACK] = BEHAVIOR_COMBAT,
    }
  },
  {ENT_ORC_FIGHTER},
  {ENT_BERSERKER},
  {ENT_HOBGOBLIN},
  {ENT_OROG},
  {ENT_SCORPION},
  {ENT_SPIDER, SIZE_TINY,"Spider", 2,6,2,SPAWN_SWARM,{GEAR_NONE},
    {ABILITY_BITE_POISON,ABILITY_DONE},
    {
      [STATE_IDLE]= BEHAVIOR_SEEK,
        [STATE_WANDER]= BEHAVIOR_WANDER,
        [STATE_AGGRO]= BEHAVIOR_MOB_AGGRO,
        [STATE_ACTION] = BEHAVIOR_TAKE_ACTION,
        [STATE_ATTACK] = BEHAVIOR_COMBAT,
    }
  },
  {ENT_TROLL},
  {ENT_TROLL_CAVE},
  {ENT_BEAR,SIZE_LARGE,"Brown Bear",1,1,1,SPAWN_SOLO,{GEAR_NONE},
    {ABILITY_SWIPE,ABILITY_BITE,ABILITY_DONE},
    {
      [STATE_IDLE]= BEHAVIOR_SEEK,
      [STATE_WANDER]= BEHAVIOR_WANDER,
      [STATE_AGGRO]= BEHAVIOR_MOB_AGGRO,
      [STATE_ACTION] = BEHAVIOR_TAKE_ACTION,
      [STATE_ATTACK] = BEHAVIOR_COMBAT,
    }
  },
};

static const spawn_rules_t dark_forest[5]= {
  {ENT_GOBLIN,SPAWN_PACK,5},
  {ENT_ORC,SPAWN_PACK,1},
  {ENT_SPIDER,SPAWN_SWARM,20},
  {ENT_BEAR,SPAWN_SOLO,50},
  {ENT_DONE}
};

static const ItemInstance room_items[GEAR_DONE] = {
  {GEAR_MACE, ITEM_WEAPON,WEAP_BLUNT,1},
  {GEAR_LEATHER_ARMOR,ITEM_ARMOR,ARMOR_LEATHER,1},
  {GEAR_LEATHER_CAP, ITEM_ARMOR,ARMOR_LEATHER,1},
};
static const TileInstance BASE_TILE = {};

typedef struct {
  BehaviorID           id;
  bool                 is_root;
  BehaviorTreeType     bt_type;
  behavior_tree_node_t *(*func)(behavior_params_t *);
  bool          param_overide;
  EntityState   state;
  int           num_children;
  BehaviorID   children[5];
} BehaviorData;

static const BehaviorData room_behaviors[ BEHAVIOR_COUNT] = {
  { BEHAVIOR_NONE},
  { BEHAVIOR_CHANGE_STATE ,false,BT_LEAF,LeafChangeState,false, STATE_IDLE,0,{}},
  { BEHAVIOR_GET_TARGET ,false,BT_LEAF,LeafAcquireTarget,false, STATE_IDLE,0,{}},
  { BEHAVIOR_GET_DEST,false,BT_LEAF,LeafAcquireDestination,false, STATE_NONE,0,{}},
  { BEHAVIOR_MOVE_TO_TARGET ,false,BT_LEAF,LeafMoveToTarget,false, STATE_IDLE,0,{}},
  { BEHAVIOR_MOVE_TO_DEST,false,BT_LEAF,LeafMoveToDestination,false, STATE_NONE,0,{}},
  {BEHAVIOR_CAN_ATTACK,false,BT_LEAF,LeafCanAttackTarget,false, STATE_NONE,0,{}},
  {BEHAVIOR_ATTACK,false,BT_LEAF,LeafAttackTarget,false, STATE_NONE,0,{}},
  {BEHAVIOR_SEE,false,BT_LEAF,LeafCanSeeTarget,false, STATE_NONE,0,{}},
  {BEHAVIOR_CHECK_TURN_STATE,false, BT_LEAF,LeafCheckTurn,false,0,0,{}},
  {BEHAVIOR_TAKE_TURN,false, BT_LEAF,LeafTakeTurn,false,0,0,{}},
  { BEHAVIOR_MOVE,false,BT_SEQUENCE, NULL,true, STATE_ACTION,3,{ BEHAVIOR_GET_DEST, BEHAVIOR_MOVE_TO_DEST,BEHAVIOR_CHANGE_STATE}},
  { BEHAVIOR_CHECK_AGGRO,false,BT_SEQUENCE, NULL,true, STATE_IDLE,2,{ BEHAVIOR_GET_TARGET, BEHAVIOR_CHANGE_STATE}},
  { BEHAVIOR_ACQUIRE,false, BT_SEQUENCE, NULL,true, STATE_AGGRO,2,{ BEHAVIOR_GET_TARGET, BEHAVIOR_CHANGE_STATE}},
  {BEHAVIOR_TRY_ATTACK, false, BT_SEQUENCE,NULL,true, STATE_ATTACK,4,{BEHAVIOR_GET_TARGET,BEHAVIOR_SEE,BEHAVIOR_CAN_ATTACK,BEHAVIOR_CHANGE_STATE}},
  {BEHAVIOR_APPROACH , false,BT_SEQUENCE, NULL,false, STATE_NONE,2,{BEHAVIOR_MOVE_TO_TARGET,BEHAVIOR_TAKE_TURN}},
  { BEHAVIOR_WANDER,true,BT_SELECTOR, NULL,false, STATE_NONE,2,{ BEHAVIOR_CHECK_AGGRO, BEHAVIOR_MOVE}},
  { BEHAVIOR_SEEK, true,BT_SELECTOR,NULL,true,STATE_WANDER,2,{ BEHAVIOR_ACQUIRE,  BEHAVIOR_CHANGE_STATE}},
  { BEHAVIOR_TAKE_ACTION,true,BT_SEQUENCE,NULL,false,0,2,{ BEHAVIOR_CHECK_TURN_STATE, BEHAVIOR_TAKE_TURN}},
  { BEHAVIOR_ACTION,false,BT_SELECTOR,NULL,false,0,2,{ BEHAVIOR_TRY_ATTACK, BEHAVIOR_APPROACH}},
  { BEHAVIOR_NO_ACTION, false, BT_SEQUENCE, NULL,true, STATE_IDLE,1,{BEHAVIOR_CHANGE_STATE}},
  { BEHAVIOR_COMBAT ,true,BT_SEQUENCE,NULL,true, STATE_ACTION,2,{ BEHAVIOR_ATTACK, BEHAVIOR_CHANGE_STATE}},
  { BEHAVIOR_MOB_AGGRO ,true,BT_SELECTOR,NULL,false, 0,2,{ BEHAVIOR_ACTION, BEHAVIOR_NO_ACTION}},
};
#endif
